## 1. 红包业务知识
### 1.1. 摇红包
1. **服务器每秒生成一定数量的红包，里面的金额不定**
2. 客户端发出一个摇红包的请求
3. 服务器检查是否还有红包剩余，有的话返回其中一个红包，否则返回空
4. 客户端获取红包
![](https://raw.githubusercontent.com/TDoct/images/master/img/20200325164712.png)

### 1.2. 发红包

1. **客户端发一个红包，确定数额和人数，请求到服务器**
2. **服务器把这个红包发给群里的所有客户端**
3. 客户端发出抢红包的请求
4. 服务器检查是否还有红包剩余，有的话返回其中一个红包，否则返回空
5. 客户端获取红包

## 2. 确定目标

- **单机并发连接数**：服务器总数600台，月活用户5.4亿，那么每个服务器支持的用户数：`5.4亿/600=90万`
- **单机峰值QPS**：服务器总数600台，整体实际QPS为1400万，那么每台服务器QPS为：`1400万/600=2.3万`
- **整体峰值持续时间**：总共请求数为100亿，整体实际QPS为1400万，那么持续时间为`100亿/1400万=714秒`
- **摇红包业务中系统生成红包速度**：服务器总数600台，整体每秒5万，那么每台服务器下发速度为：`5万/600=83`
- **摇红包业务中用户摇一摇的速度**：摇红包次数为100亿，假设发生在4个小时内，那么用户摇一摇的QPS为：`100亿/600/3600/4=1157`


## 3. 实现思路
### 3.1. 单机百万连接
[如何设计一个高并发的系统.md](如何设计一个高并发的系统.md)

### 3.2. 单机3万QPS

- 客户端
    - 总共有100万个连接，QPS为3万，那么每个连接每`1000000（请求）/30000（请求/s）= 33s`需要向服务器发一个摇红包请求

- 服务器
    - 服务器只需要处理客户端的请求即可
    - 记录每秒处理的请求数目，这需要在代码里埋入计数器
    - 我们需要监控网络，因为网络的吞吐情况，可以客观的反映出QPS的真实数据



## 4. 参考
- [扛住100亿次请求？我们来试一试 · xiaojiaqi/10billionhongbaos Wiki](https://github.com/xiaojiaqi/10billionhongbaos/wiki/%E6%89%9B%E4%BD%8F100%E4%BA%BF%E6%AC%A1%E8%AF%B7%E6%B1%82%EF%BC%9F%E6%88%91%E4%BB%AC%E6%9D%A5%E8%AF%95%E4%B8%80%E8%AF%95)
- [春晚微信红包，是怎么扛住一百亿次请求的 \- InfoQ](https://www.infoq.cn/article/weixin-bonus-load)