[toc]
 
## 1. 什么是秒杀系统
秒杀就是在**同一时刻大量请求**争抢购买同一商品并完成交易的过程
## 2. 秒杀系统特点
- 高性能：秒杀涉及大量的并发读和并发写，因此支持高并发访问这点非常关键
- 一致性：秒杀商品减库存的实现方式同样关键，有限数量的商品在同一时刻被很多倍的请求同时来减库存，在大并发更新的过程中都要保证数据的准确性。
- 高可用：秒杀时会在一瞬间涌入大量的流量，为了避免系统宕机，保证高可用，需要做好流量限制
## 3. 如何设计秒杀系统
### 3.1. 设计思想

将请求拦截在系统上游，降低下游压力。

### 3.2. 分层架构

![](https://raw.githubusercontent.com/TDoct/images/master/img/20191228175718.png)
#### 3.2.1. 前端
- 限制用户在 x 秒之内只能提交一次请求
- 用户点击“查询”或者“购票”后，按钮置灰，防止重复提交（拦截小白用户重复点）
- CDN缓存静态资源

#### 3.2.2. 服务器代理
使用Nginx反向代理负载均衡

#### 3.2.3. 后端服务器
- 限流（拦截程序员for循环调用接口）
限制同一用户的请求频率
去重依据：uid即可（因为用户必须登陆）。其他的如ip等
- 缓存
使用redis抗读请求
- 队列
使用队列对写请求排队（防止黑客使用uid调用接口）
- 异步
使用mq抗写请求（根据实际业务解耦，比如下单和付款）


#### 3.2.4. 数据库
- 数据库订阅mq，进行真正的减库存
- 热点隔离
使用单独的数据库、单独的服务器来部署秒杀，防止影响到业务系统

## 4. 参考
- [秒杀业务架构优化之路\-InfoQ](https://www.infoq.cn/article/flash-deal-architecture-optimization/)
- [Java开发面试：高并发秒杀系统如何设计与优化\_此处省略三千字\-CSDN博客](https://blog.csdn.net/CSDN_Terence/article/details/77744042)
- [一个秒杀系统的设计思考 \- SegmentFault 思否](https://segmentfault.com/a/1190000020970562#:~:text=%E7%AE%80%E5%8D%95%E6%9D%A5%E8%AF%B4%EF%BC%8C%E7%A7%92%E6%9D%80%E5%B0%B1%E6%98%AF,%E5%8F%AF%E7%94%A8%E7%9A%84%E4%B8%89%E9%AB%98%E7%B3%BB%E7%BB%9F%E3%80%82)
- [如何设计一个秒杀系统 — G\.Fukang's Blog](https://gongfukangee.github.io/2019/06/09/SecondsKill/)


