## 1. 超时重试是什么
- 超时：服务A调用服务B，为了防止服务A请求服务B但是一直没有响应，导致服务A的线程等资源一直hold着无法释放，因此需要设置超时
- 重试：服务A调用服务B，如果服务A请求服务B发生了网络错误，那么会触发超时，但是这个网络是暂时的，因此重试几次可能就好了
## 2. 怎么设计超时重试
### 2.1. 超时
#### 2.1.1. 超时时长
- 刚上线的服务通过压测：一般N个9的耗时为200ms时，取平均耗时做超时时间
- 已有的服务通过监控：平均响应时间
### 2.2. 重试
#### 2.2.1. 什么错误可以重试
- 调用超时、被调用端返回了某种可以重试的错误（如繁忙中、流控中、维护中、资源不足等）
#### 2.2.2. 重试的策略
- 指数级退避
- 重置超时时间
#### 2.2.3. 重试的前提
- 被调是幂等的
#### 2.2.4. 重试次数
- 压测计算最大支持的并发度是多少
- 如果上游有传递时间，那么根据这个时间来确定重试次数，否则走默认值，比如Linux TCP重试次数为5次
## 3. 超时重试组件
- [如何设计容错组件.md](../../Software_Engineering/Architecture/架构模式/微服务/如何设计容错组件.md)

## 4. 参考
- [面试官：服务A调用服务B，你们超时与重试策略是怎样的，比如超时时长怎么确认，重试次数怎么确定](https://maimai.cn/web/gossip_detail?gid=29261194&egid=47b6bec0f73611eb9097801844e2d86c)
- [有关重试的一般性指南 \- Best practices for cloud applications \| Microsoft Docs](https://docs.microsoft.com/zh-cn/azure/architecture/best-practices/transient-faults#general-guidelines)
- [TCP/IP： 超时，重传，控流，拥塞处理 \- 知乎](https://zhuanlan.zhihu.com/p/41197705)
- [如何优雅地重试](https://www.toutiao.com/i6913864937710649867/?wid=1646899096640)
- [如何优雅地重试](https://www.toutiao.com/i6913864937710649867/?wid=1646899096640)