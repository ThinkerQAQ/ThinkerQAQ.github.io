## 1. perf命令
是 Linux 系统原生提供的性能分析工具，会返回 CPU 正在执行的函数名以及调用栈（stack）
### 1.1. 使用
```shell
sudo perf record -F 99 -p 13204 -g -- sleep 30
```
- perf record表示记录
- -F 99表示每秒99次。如果99次都返回同一个函数名，那就说明 CPU 这一秒钟都在执行同一个函数，可能存在性能问题
- -p 13204是进程号，即对哪个进程进行分析
- -g表示记录调用栈
- sleep 30则是持续30秒
## 2. 火焰图
### 2.1. 为什么有
由于perf结果可读性太差，于是有了火焰图
## 3. 什么是火焰图
火焰图是基于 perf 结果产生的 SVG 图片，用来展示 CPU 的调用栈
### 3.1. 例子
![](http://queue.acm.org/downloads/2016/Gregg4.svg)
- y 轴表示调用栈，每一层都是一个函数。调用栈越深，火焰就越高，顶部就是正在执行的函数，下方都是它的父函数。
- x 轴表示抽样数，如果一个函数在 x 轴占据的宽度越宽，就表示它被抽到的次数多，即执行的时间长。注意，x 轴不代表时间，而是所有的调用栈合并后，按字母顺序排列的。
- 互动
    - 鼠标悬浮时会显示完整的函数名、抽样抽中的次数、占据总抽样次数的百分比
    - 在某一层点击，火焰图会水平放大，该层会占据所有宽度，显示详细信息
    - 按下 Ctrl + F 会显示一个搜索框，用户可以输入关键词或正则表达式，所有符合条件的函数名会高亮显示
## 4. 使用
- [pprof.md](../../Golang/pprof.md)
## 5. 参考
- [如何读懂火焰图？ \- 阮一峰的网络日志](https://www.ruanyifeng.com/blog/2017/09/flame-graph.html)